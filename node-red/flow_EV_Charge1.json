[{"id":"e2675ef4094d2c74","type":"tab","label":"EV Charging","disabled":false,"info":"The EV Charging allow you to charge the EV Battery at home according your needs and with minimum power from the grid.\n\nThe Charging has 4 modes:\n\n - Manual\n - Solar (Charges if the Solar Battery SOC reaches a certain level)\n - Schedule (Allows eg. charging at night with a lower grid tariff)\n - Solar&Schedule (Combination of Solar&Scheduled charging)"},{"id":"05c478575d8edbca","type":"api-current-state","z":"e2675ef4094d2c74","name":"Plug State off","server":"467d275d.a68208","version":2,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.binary_power_switch_cabinet_s1_plug_carport","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"x":800,"y":180,"wires":[["3a98631f08023abf"],[]]},{"id":"3a98631f08023abf","type":"api-call-service","z":"e2675ef4094d2c74","name":"EV Plug ON","server":"467d275d.a68208","version":3,"debugenabled":false,"service_domain":"switch","service":"turn_on","entityId":"switch.binary_power_switch_cabinet_s1_plug_carport","data":"","dataType":"json","mergecontext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":810,"y":240,"wires":[[]]},{"id":"7a386c8543f287d7","type":"api-call-service","z":"e2675ef4094d2c74","name":"EV Plug OFF","server":"467d275d.a68208","version":3,"debugenabled":false,"service_domain":"switch","service":"turn_off","entityId":"switch.binary_power_switch_cabinet_s1_plug_carport","data":"","dataType":"json","mergecontext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":810,"y":60,"wires":[[]]},{"id":"6f2de5187a28ade2","type":"delay","z":"e2675ef4094d2c74","name":"5 Min Delay","pauseType":"delay","timeout":"5","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":790,"y":120,"wires":[["7a386c8543f287d7"]]},{"id":"ee9f6c4c3b0dad60","type":"server-state-changed","z":"e2675ef4094d2c74","name":"EV charging mode","server":"467d275d.a68208","version":3,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_select.ev_charging_mode","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":90,"y":100,"wires":[["64f45ecb39f8d294"]]},{"id":"64f45ecb39f8d294","type":"switch","z":"e2675ef4094d2c74","name":"mode","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"off","vt":"str"},{"t":"eq","v":"schedule","vt":"str"},{"t":"eq","v":"solar","vt":"str"},{"t":"eq","v":"manual","vt":"str"},{"t":"eq","v":"solar&schedule","vt":"str"}],"checkall":"true","repair":false,"outputs":5,"x":250,"y":100,"wires":[["7a386c8543f287d7","ceb73fc8f071382a"],["7a386c8543f287d7","da5c28f003642533"],["7a386c8543f287d7","ceb73fc8f071382a"],["05c478575d8edbca","ceb73fc8f071382a"],["da5c28f003642533"]]},{"id":"1fd30f2150a2820d","type":"poll-state","z":"e2675ef4094d2c74","name":"battery SOC > set = on","server":"467d275d.a68208","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"5","updateIntervalUnits":"minutes","outputinitially":true,"outputonchanged":true,"entity_id":"sensor.battery_state_of_charge","state_type":"num","halt_if":"$entities('input_number.victron_battery_soc_treshold_ev_charging').state","halt_if_type":"jsonata","halt_if_compare":"gt","outputs":2,"x":100,"y":240,"wires":[["5b19265141dde464"],[]]},{"id":"0e6e6d9bc5365802","type":"poll-state","z":"e2675ef4094d2c74","name":"battery SOC < set = off","server":"467d275d.a68208","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"5","updateIntervalUnits":"minutes","outputinitially":true,"outputonchanged":true,"entity_id":"sensor.battery_state_of_charge","state_type":"num","halt_if":"$entities('input_number.victron_battery_soc_treshold_ev_charging').state","halt_if_type":"jsonata","halt_if_compare":"lt","outputs":2,"x":100,"y":300,"wires":[["357d3d69d48e0886"],[]]},{"id":"357d3d69d48e0886","type":"api-current-state","z":"e2675ef4094d2c74","name":"Check EV mode = S&Solar","server":"467d275d.a68208","version":2,"outputs":2,"halt_if":"solar, solar&schedule","halt_if_type":"str","halt_if_compare":"includes","entity_id":"input_select.ev_charging_mode","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"x":330,"y":300,"wires":[["c17f8bbc7b32a095"],[]]},{"id":"4bc35be53eeea405","type":"api-current-state","z":"e2675ef4094d2c74","name":"Plug State on","server":"467d275d.a68208","version":2,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.binary_power_switch_cabinet_s1_plug_carport","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"x":620,"y":280,"wires":[["6f2de5187a28ade2"],[]]},{"id":"569e4479df9ebf89","type":"server-state-changed","z":"e2675ef4094d2c74","name":"Multi Temperature alarm","server":"467d275d.a68208","version":3,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.multi_temperature_alarm","entityidfiltertype":"exact","outputinitially":true,"state_type":"num","haltifstate":"0","halt_if_type":"num","halt_if_compare":"gt","outputs":2,"output_only_on_state_change":true,"for":"5","forType":"num","forUnits":"seconds","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":110,"y":360,"wires":[["32180ec2845c8169"],[]]},{"id":"cf903ebf86abda99","type":"server-state-changed","z":"e2675ef4094d2c74","name":"Grid power > 800W","server":"467d275d.a68208","version":3,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.multiplus_grid_power","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"800","halt_if_type":"num","halt_if_compare":"gt","outputs":2,"output_only_on_state_change":true,"for":"3","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":90,"y":460,"wires":[["32180ec2845c8169"],[]]},{"id":"1739d15c952a4d06","type":"api-current-state","z":"e2675ef4094d2c74","name":"Plug State on","server":"467d275d.a68208","version":2,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.binary_power_switch_cabinet_s1_plug_carport","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"x":680,"y":400,"wires":[["7a386c8543f287d7"],[]]},{"id":"855ee67f628d0978","type":"comment","z":"e2675ef4094d2c74","name":"EV Charging off due to high loads","info":"","x":370,"y":360,"wires":[]},{"id":"6a7d1753b2e16738","type":"comment","z":"e2675ef4094d2c74","name":"EV Charging ","info":"","x":70,"y":20,"wires":[]},{"id":"2a400e22acada67f","type":"api-current-state","z":"e2675ef4094d2c74","name":"Check mode =Solar/sch","server":"467d275d.a68208","version":2,"outputs":2,"halt_if":"solar, solar&schedule","halt_if_type":"str","halt_if_compare":"includes","entity_id":"input_select.ev_charging_mode","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"x":580,"y":200,"wires":[["05c478575d8edbca"],[]]},{"id":"85b06c827bbaff13","type":"api-current-state","z":"e2675ef4094d2c74","name":"Check EV mode = Solar","server":"467d275d.a68208","version":2,"outputs":2,"halt_if":"solar, solar&schedule","halt_if_type":"str","halt_if_compare":"includes","entity_id":"input_select.ev_charging_mode","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"x":430,"y":470,"wires":[["1739d15c952a4d06"],["1569373dba12d7ac"]]},{"id":"67f7c7ba4908fb16","type":"server-state-changed","z":"e2675ef4094d2c74","name":"Multi Overload alarm","server":"467d275d.a68208","version":3,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.multi_overload_alarm","entityidfiltertype":"exact","outputinitially":true,"state_type":"num","haltifstate":"0","halt_if_type":"num","halt_if_compare":"gt","outputs":2,"output_only_on_state_change":true,"for":"5","forType":"num","forUnits":"seconds","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":90,"y":400,"wires":[["32180ec2845c8169"],[]]},{"id":"1569373dba12d7ac","type":"api-current-state","z":"e2675ef4094d2c74","name":"Plug State off","server":"467d275d.a68208","version":2,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.binary_power_switch_cabinet_s1_plug_carport","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"x":680,"y":460,"wires":[[],[]]},{"id":"73161d3697595436","type":"server-state-changed","z":"e2675ef4094d2c74","name":"Solar power < 1.4 kW","server":"467d275d.a68208","version":3,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.multiplus_solar_power","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"1400","halt_if_type":"num","halt_if_compare":"lt","outputs":2,"output_only_on_state_change":true,"for":"10","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":100,"y":520,"wires":[["32180ec2845c8169"],[]]},{"id":"11cdd1969cd3ea14","type":"poll-state","z":"e2675ef4094d2c74","name":"Poll state Charging mode","server":"467d275d.a68208","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"60","updateIntervalUnits":"seconds","outputinitially":false,"outputonchanged":false,"entity_id":"input_select.ev_charging_mode","state_type":"str","halt_if":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"x":310,"y":20,"wires":[["4c37226993e6ec0e"]]},{"id":"4c37226993e6ec0e","type":"api-current-state","z":"e2675ef4094d2c74","name":"Check EV mode = Off","server":"467d275d.a68208","version":2,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_select.ev_charging_mode","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"x":560,"y":20,"wires":[["4bc35be53eeea405"],[]]},{"id":"3bab8a655641253e","type":"api-current-state","z":"e2675ef4094d2c74","name":"Check EV mode = Solar","server":"467d275d.a68208","version":2,"outputs":2,"halt_if":"solar","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_select.ev_charging_mode","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"x":370,"y":620,"wires":[["b74e9b2e5cc5975d"],[]]},{"id":"7cb2123df143eade","type":"comment","z":"e2675ef4094d2c74","name":"EV Charging message to tablet","info":"","x":130,"y":580,"wires":[]},{"id":"b74e9b2e5cc5975d","type":"api-current-state","z":"e2675ef4094d2c74","name":"Plug State on","server":"467d275d.a68208","version":2,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.binary_power_switch_cabinet_s1_plug_carport","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"x":600,"y":620,"wires":[["1e8c3e33a4988c26"],[]]},{"id":"8bb4e519fa5da413","type":"server-state-changed","z":"e2675ef4094d2c74","name":"Load power < 1800W","server":"467d275d.a68208","version":3,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.multiplus_ac_loads","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"1800","halt_if_type":"num","halt_if_compare":"lt","outputs":2,"output_only_on_state_change":true,"for":"10","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":100,"y":620,"wires":[["3bab8a655641253e"],[]]},{"id":"1e8c3e33a4988c26","type":"api-call-service","z":"e2675ef4094d2c74","name":"Notify Tablet: Car not plugged in ","server":"467d275d.a68208","version":3,"debugenabled":false,"service_domain":"notify","service":"mobile_app_sm_t813","entityId":"","data":"{\"message\":\"Auto nicht an Dose angeschlossen. Laden?\"}","dataType":"json","mergecontext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":670,"y":680,"wires":[[]]},{"id":"ceb73fc8f071382a","type":"api-call-service","z":"e2675ef4094d2c74","name":"Scheduler OFF","server":"467d275d.a68208","version":3,"debugenabled":false,"service_domain":"switch","service":"turn_off","entityId":"switch.schedule_ev_charge","data":"","dataType":"json","mergecontext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":540,"y":100,"wires":[[]]},{"id":"da5c28f003642533","type":"api-call-service","z":"e2675ef4094d2c74","name":"Scheduler ON","server":"467d275d.a68208","version":3,"debugenabled":false,"service_domain":"switch","service":"turn_on","entityId":"switch.schedule_ev_charge","data":"","dataType":"json","mergecontext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":540,"y":140,"wires":[[]]},{"id":"5b19265141dde464","type":"api-current-state","z":"e2675ef4094d2c74","name":"Solar power > 1.8k","server":"467d275d.a68208","version":2,"outputs":2,"halt_if":"1800","halt_if_type":"num","halt_if_compare":"gt","entity_id":"sensor.multiplus_solar_power","state_type":"num","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"x":330,"y":240,"wires":[["2a400e22acada67f"],[]]},{"id":"604f9da534e362d5","type":"api-current-state","z":"e2675ef4094d2c74","name":"Solar power > 1k","server":"467d275d.a68208","version":2,"outputs":2,"halt_if":"1000","halt_if_type":"num","halt_if_compare":"gt","entity_id":"sensor.multiplus_solar_power","state_type":"num","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"x":330,"y":200,"wires":[["2a400e22acada67f"],[]]},{"id":"85e4439e85bf5278","type":"poll-state","z":"e2675ef4094d2c74","name":"battery SOC > 90% = on","server":"467d275d.a68208","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"5","updateIntervalUnits":"minutes","outputinitially":true,"outputonchanged":true,"entity_id":"sensor.battery_state_of_charge","state_type":"num","halt_if":"90","halt_if_type":"num","halt_if_compare":"gt","outputs":2,"x":110,"y":200,"wires":[["604f9da534e362d5"],[]]},{"id":"2149d652b0835383","type":"server-state-changed","z":"e2675ef4094d2c74","name":"Charging off when limit setpoint reached","server":"467d275d.a68208","version":3,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_number.ev_charging_scheduled_charge_limit","entityidfiltertype":"exact","outputinitially":false,"state_type":"num","haltifstate":"$entities('sensor.multiplus_ac_loads').state","halt_if_type":"jsonata","halt_if_compare":"gt","outputs":2,"output_only_on_state_change":true,"for":"1","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":150,"y":680,"wires":[[],[]]},{"id":"887a18fc9a284bd3","type":"poll-state","z":"e2675ef4094d2c74","name":"battery SOC > 99% = on","server":"467d275d.a68208","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"1","updateIntervalUnits":"minutes","outputinitially":true,"outputonchanged":true,"entity_id":"sensor.battery_state_of_charge","state_type":"num","halt_if":"99","halt_if_type":"num","halt_if_compare":"gte","outputs":2,"x":110,"y":160,"wires":[["2a400e22acada67f"],[]]},{"id":"32180ec2845c8169","type":"api-current-state","z":"e2675ef4094d2c74","name":"charging scheduled off","server":"467d275d.a68208","version":2,"outputs":2,"halt_if":"false","halt_if_type":"bool","halt_if_compare":"is","entity_id":"input_boolean.ev_charging_scheduled_onoff","state_type":"habool","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"x":320,"y":420,"wires":[["85b06c827bbaff13"],[]]},{"id":"c17f8bbc7b32a095","type":"api-current-state","z":"e2675ef4094d2c74","name":"Check scheduled=off","server":"467d275d.a68208","version":2,"outputs":2,"halt_if":"false","halt_if_type":"bool","halt_if_compare":"is","entity_id":"input_boolean.ev_charging_scheduled_onoff","state_type":"habool","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"x":600,"y":330,"wires":[["4bc35be53eeea405"],[]]},{"id":"467d275d.a68208","type":"server","name":"Home Assistant","version":1,"legacy":false,"addon":true,"rejectUnauthorizedCerts":true,"ha_boolean":"y|yes|true|on|home|open","connectionDelay":true,"cacheJson":true,"info":"y|yes|true|on|home|open"}]